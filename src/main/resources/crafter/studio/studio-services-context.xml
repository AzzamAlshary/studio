<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

      <!-- ////////////////////////////////////// -->
      <!--         logging                        -->
      <!-- ////////////////////////////////////// -->
      <bean id="cstudioLogProvider" class="org.craftercms.cstudio.impl.log.l4j.L4jLogProvider"
            init-method="init">
      </bean>


       <bean id="cstudioServicesManager" class="org.craftercms.cstudio.alfresco.service.ServicesManager" />

       <bean id="cstudioRegistrableService" class="org.craftercms.cstudio.alfresco.service.AbstractRegistrableService"
             abstract="true" init-method="register">
              <property name="servicesManager" ref="cstudioServicesManager" />
       </bean>

    <!-- ////////////////////////////////////// -->
    <!--         Services                       -->
    <!-- ////////////////////////////////////// -->
    <bean id="cstudioDmDeploymentService" class="org.craftercms.cstudio.alfresco.dm.service.impl.DmDeploymentServiceImpl"
         parent="cstudioRegistrableService">
          <property name="deploymentService" ref="cstudioDeploymentServiceSimple" />
    </bean>

    <bean id="cstudioTransactionServiceSimple" class="org.craftercms.cstudio.impl.service.transaction.TransactionServiceImpl">
        <!--property name="contentRepository" ref="cstudioContentRepository" /-->
    </bean>

    <bean id="cstudioAuthenticationServiceSimple" class="org.craftercms.cstudio.impl.service.authentication.AuthenticationServiceImpl">
        <!--property name="contentRepository" ref="cstudioContentRepository" /-->
    </bean>

    <bean id="cstudioSiteServiceSimple" class="org.craftercms.cstudio.impl.service.site.SiteServiceImpl">
        <!--property name="siteServiceDAL" ref="cstudioRepositorySiteServiceDAL" /-->
    </bean>

    <bean id="cstudioWorkflowService" class="org.craftercms.cstudio.impl.service.workflow.WorkflowServiceImpl">
        <!--property name="workflowJobDAL" ref="cstudioWorkflowJobDAL" / -->
        <!--property name="notificationService" ref="cstudioNotificationService" /-->
        <!-- remove this asap -->
        <!--property name="dmWorkflowService" ref="cstudioDmWorkflowService" /-->
    </bean>

       <bean id="cstudioDeploymentServiceSimple" class="org.craftercms.cstudio.impl.service.deployment.DeploymentServiceImpl" >
              <!--property name="contentRepository" ref="cstudioContentRepository" / -->
              <!--property name="deploymentDAL" ref="cstudioDeploymentServiceDAL" /-->
       </bean>

       <bean id="cstudioTranslationService" class="org.craftercms.cstudio.impl.service.translation.TranslationServiceImpl">
            <property name="translationContentDAL" ref="cstudioTranslationContentDAL" />
            <property name="translationProvider" ref="demoTranslationProvider" />
        </bean>


    <!-- ////////////////////////////////////// -->
    <!--         translation                    -->
    <!-- ////////////////////////////////////// -->

    <!-- translation vendor interface -->
    <bean id="smartlingTranslationProvider" class="org.craftercms.cstudio.impl.service.translation.provider.smartling.SmartlingTranslationProvider">
    </bean>

    <bean id="demoTranslationProvider" class="org.craftercms.cstudio.impl.service.translation.provider.demo.DemoTranslationProvider">
        <property name="translateElements">
            <list>
                <value>title</value>
                <value>body</value>
                <value>body_html</value>
            </list>
        </property>
    </bean>

    <bean id="cstudioTranslationContentDAL" class="org.craftercms.cstudio.impl.service.translation.dal.repository.RepositoryTranslationContentDAL">
        <!-- property name="contentRepository" ref="cstudioContentRepository" /-->
    </bean>

    <bean id="cstudioWorkflowManager" class="org.craftercms.cstudio.impl.service.workflow.WorkflowManager">
        <!--property name="workflowService" ref="cstudioWorkflowService" /-->
        <property name="jobStateHandlers" >
            <map>
                <entry key="submit-for-translate">
                    <map>
                        <entry key="created">
                            <bean class="org.craftercms.cstudio.impl.service.workflow.handler.JobCreatedHandler">
                            </bean>
                        </entry>
                        <entry key="started">
                            <!-- determine what items for be translated for each child site and submit workflows then end -->
                            <bean class="org.craftercms.cstudio.impl.service.translation.workflow.handler.KickoffTranslationWorkflowForWaterfallItemsHandler">
                                <!--property name="siteService" ref="cstudioSiteServiceSimple" /-->
                                <property name="translationService" ref="cstudioTranslationService" />
                                <!--property name="dependencyService" ref="cstudioDmDependencyService" /-->
                            </bean>
                        </entry>
                        <entry key="ended">
                            <bean class="org.craftercms.cstudio.impl.service.workflow.handler.JobEndedHandler"/>
                        </entry>
                    </map>
                </entry>
                <entry key="translate">
                    <map>
                        <entry key="created">
                            <bean class="org.craftercms.cstudio.impl.service.workflow.handler.JobCreatedHandler">
                            </bean>
                        </entry>
                        <entry key="started">
                            <!-- send item out for translation and start waiting for it to complete -->
                            <bean class="org.craftercms.cstudio.impl.service.translation.workflow.handler.SendItemOutForTranslationHandler">
                                <property name="translationService" ref="cstudioTranslationService" />
                            </bean>
                        </entry>
                        <entry key="WAITING-FOR-TRANSLATION">
                            <!-- check translation status on item until it's complete -->
                            <bean class="org.craftercms.cstudio.impl.service.translation.workflow.handler.UpdateItemTranslationStatusHandler">
                                <property name="translationService" ref="cstudioTranslationService" />
                            </bean>
                        </entry>
                        <entry key="TRANSLATION-COMPLETE">
                            <!-- retrieve item from translation provider, add to project and submit for review -->
                            <bean class="org.craftercms.cstudio.impl.service.translation.workflow.handler.UpdateProjectWithTranslationHandler">
                                <property name="translationService" ref="cstudioTranslationService" />
                            </bean>
                        </entry>
                        <entry key="SITE-UPDATED-WITH-TRANSLATED-CONTENT">
                            <!-- retrieve item from translation provider, add to project and submit for review -->
                            <bean class="org.craftercms.cstudio.impl.service.workflow.handler.SubmitContentforApprovalHandler"/>
                        </entry>
                        <entry key="ended">
                            <bean class="org.craftercms.cstudio.impl.service.workflow.handler.JobEndedHandler"/>
                        </entry>
                    </map>
                </entry>
            </map>
        </property>
    </bean>

    <!-- Jobs -->
    <bean id="cstudioProcessInFlightJobs" class="org.craftercms.cstudio.impl.service.workflow.job.ProcessInFlightJobs">
        <!--
        <property name="workflowService" ref="cstudioWorkflowService" />
        <property name="workflowManager" ref="cstudioWorkflowManager"/>
        <property name="transactionService" ref="cstudioTransactionServiceSimple" />
        <property name="authenticationService" ref="cstudioAuthenticationServiceSimple" />
        -->
    </bean>

    <!-- scheduled actions -->
    <bean id="cstudioProcessInFlightJobsScheduled" class="org.springframework.scheduling.quartz.SimpleTriggerFactoryBean">
        <property name="jobDetail">
            <bean class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean">
              <property name="targetObject" ref="cstudioProcessInFlightJobs"/>
               <property name="targetMethod" value="execute"/>
            </bean>
        </property>
        <property name="repeatInterval" value="5000" />  
        <property name="startDelay" value="1000" />  
    </bean>

</beans>