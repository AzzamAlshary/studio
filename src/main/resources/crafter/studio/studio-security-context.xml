<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Crafter Studio Web-content authoring solution
  ~ Copyright (C) 2007-2016 Crafter Software Corporation.
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as published by
  ~ the Free Software Foundation, either version 3 of the License, or
  ~ (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.
  ~
  -->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:security="http://www.springframework.org/schema/security"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/security
		http://www.springframework.org/schema/security/spring-security.xsd">
<!--
    <bean id="studioSecurityFilterChain" class="org.springframework.security.web.FilterChainProxy">
        <constructor-arg>
            <list>
                <security:filter-chain pattern="/api/**" filters="securityContextPersistenceFilterWithASCFalse,basicAuthenticationFilter,exceptionTranslationFilter,filterSecurityInterceptor" />
                <security:filter-chain pattern="/**" filters="securityContextPersistenceFilterWithASCTrue,formLoginFilter,exceptionTranslationFilter,filterSecurityInterceptor" />
            </list>
        </constructor-arg>
    </bean>
--><!--
    <security:global-method-security pre-post-annotations="enabled" />

    <security:http pattern="/#/login" security="none"/>
    <security:http pattern="/api/1/services/api/1/user/login.json" security="none"/>
    <security:http pattern="/api/1/services/api/1/user/logout.json" security="none"/>
    <security:http pattern="/api/1/services/api/1/server/get-available-languages.json" security="none"/>
    <security:http pattern="/static-assets/**" security="none"/>
    <security:http pattern="/templates/**" security="none" />
-->

    <security:http pattern="/api/1/services/api/1/user/login.json" security="none"/>
    <security:http pattern="/api/1/services/api/1/user/logout.json" security="none"/>
    <security:http pattern="/api/1/services/api/1/server/get-available-languages.json" security="none"/>

    <security:http use-expressions="true" auto-config="true" entry-point-ref="studioAuthenticationEntryPoint">
        <security:intercept-url pattern="/api/**" access="isAuthenticated()" />
        <security:intercept-url pattern="/**" access="permitAll" />

        <security:form-login login-page="/#/login" default-target-url="/#/sites"/>
        <!--security:logout delete-cookies="JSESSIONID" />
        <security:session-management invalid-session-url="/#/login">
            <security:concurrency-control max-sessions="1" error-if-maximum-exceeded="true" />
        </security:session-management>
        -->
    </security:http>


    <!--
    <security:http>
        <security:intercept-url pattern="/#/login" access="permitAll"/>
        <security:intercept-url pattern="/api/1/services/api/1/user/login.json" access="permitAll"/>
        <security:intercept-url pattern="/api/1/services/api/1/user/logout.json" access="permitAll"/>
        <security:intercept-url pattern="/api/1/services/api/1/server/get-available-languages.json" access="permitAll"/>
    </security:http>
-->
        <!--security:form-login login-page="/#/login" default-target-url="/#/sites" authentication-failure-url="/#/login" /-->
<!--
    <security:http pattern="/**" entry-point-ref="studioAuthenticationEntryPoint"/> create-session="ifRequired">
        <security:csrf disabled="true"/>
        <security:custom-filter before="FORM_LOGIN_FILTER" ref="studioAuthenticationFilter"/>
    </security:http>-->
<!--
    <security:http auto-config="true" use-expressions="true">
        <security:intercept-url pattern="/**" access="authenticated" />
        <security:form-login login-page="/#/login" default-target-url="/#/sites"/>
        <security:logout delete-cookies="JSESSIONID" />
        <security:session-management invalid-session-url="/#/login">
            <security:concurrency-control max-sessions="1" error-if-maximum-exceeded="true" />
        </security:session-management>
    </security:http>
-->

    <security:authentication-manager>
        <security:authentication-provider>
            <security:user-service>
                <security:user name="admin" password="admin" authorities="ROLE_USER" />
            </security:user-service>
        </security:authentication-provider>
    </security:authentication-manager>

    <bean id="studioAuthenticationProvider" class="org.craftercms.studio.impl.v1.service.security.StudioAuthenticationProvider">

    </bean>

    <!--<bean id="studioAuthenticationEntryPoint" class="org.springframework.security.web.authentication.LoginUrlAuthenticationEntryPoint">
        <constructor-arg name="loginFormUrl" value="/#/login"/>
    </bean>-->

    <bean id="studioAuthenticationEntryPoint" class="org.craftercms.studio.impl.v1.service.security.StudioAuthenticationEntryPoint">
        <property name="securityService" ref="cstudioSecurityService"/>
    </bean>

<!--
    <bean id="studioAuthenticationFilter" class="org.craftercms.studio.impl.v1.service.security.StudioAuthenticationFilter">
        <constructor-arg name="defaultFilterProcessesUrl" value="/**"/>
        <property name="authenticationManager" ref="authenticationManager" />
        <property name="authenticationSuccessHandler" ref="studioAuthenticationSuccessHandler" />
    </bean>
-->
    <bean id="studioAuthenticationSuccessHandler" class="org.craftercms.studio.impl.v1.service.security.StudioAuthenticationSuccessHandler" />

</beans>